<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cálculadora Arcane Symbols Maplestory</title>
    <link rel="icon" type="image/x-icon" href="favicon.png">
    <meta name="keywords" content="HTML, CSS, Javascript, Trabalho, WebDev">
    <meta name="author" content="João Nícolas">
    <link rel="stylesheet" href="style.css">
    
    <script>
        let date = new Date();

        function calculaTempo(){
            let exp, tempo, temporario, diasWeekly;
            let ganhoDiario = Number(document.getElementById("daily").value);

            <!--Analisa os -->
            switch (document.getElementById('nivel').value) {
                case '1':
                    exp = 0;
                    break;
                case '2':
                    exp = 12;
                    break;
                case '3':
                    exp = 27;
                    break;                    
                case '4':
                    exp = 47;
                    break;
                case '5':
                    exp = 74;
                    break;
                case '6':
                    exp = 110;
                    break;
                case '7':
                    exp = 157;
                    break;
                case '8':
                    exp = 217;
                    break;
                case '9':
                    exp = 292;
                    break;
                case '10':
                    exp = 384;
                    break;
                case '11':
                    exp = 495;
                    break;
                case '12':
                    exp = 627;
                    break;
                case '13':
                    exp = 782;
                    break;
                case '14':
                    exp = 962;
                    break;
                case '15':
                    exp = 1169;
                    break;
                case '16':
                    exp = 1405;
                    break;
                case '17':
                    exp = 1672;
                    break;
                case '18':
                    exp = 1972;
                    break;
                case '19':
                    exp = 2307;
                    break;
                case '20':
                    exp = 2679;
                    break;
            }
            exp = exp + Number(document.getElementById('experiencia').value);
            
            if(exp < 2679){
                tempo = Math.ceil((2679-exp)/ganhoDiario);
                diasWeekly = Math.ceil(tempo/7);

                if(date.getDay() != 0)
                {
                    diasWeekly = diasWeekly - 1;    
                }

                temporario = Number(document.getElementById("weekly").value);
                temporario = diasWeekly * temporario;
                temporario = Math.floor(temporario/ganhoDiario);

                if(temporario => 7){
                    temporario = temporario - Math.floor(temporario/7);
                }

                tempo = tempo - temporario;
                document.getElementById('tempo').innerHTML =  tempo + " dias.";          
            }
            
            else{
                document.getElementById('tempo').innerHTML = "Simbolo já completo";   
            }

        }


        function aumentaEXP(incremento) {
            document.getElementById('experiencia').value = Number(document.getElementById('experiencia').value) + Number(incremento);
        }

        /*
        Known Bug:
        A lógica não funciona corretamente quando se leva em consideração as weeklies, causando assim imprecisões.
        É preciso reestruturar a lógica, de forma que o cálculo seja feito por semanas e depois convertido para dias.
        */




    </script>
</head>
<body>   
    <div id="areaCalc" class="grid">
        
        <div class="titulo"><h3>Arcane Symbol</h3></div>
        
        <div class="areaEXP">
            <div><label for="nivel">Nível:</label></div>
            <div><input type="number" id="nivel" name="nivel" min="1" max="20" value="18" style="width: 50px"></div>
            <div><label for="quantity">Experiência:</label></div>
            <div><input type="number" id="experiencia" name="experiencia"  min="0" value="376" style="width: 50px"></div>    
        </div>

        <div class="areaValores">
            <div><label for="daily">Ganho diário:</label></div>
            <div>
                <select id="daily" name="daily">
                    <option selected="selected">20</option>
                    <option>21</option>
                    <option>22</option>
                    <option>24</option>
                    <option>26</option>
                    <option>28</option>
                    <option>30</option>
                </select>
            </div>
            
            
            <div><label for="weekly">Ganho semanal:</label></div>
            <div>            
                <select id="weekly" name="weekly">
                    <option>0</option>
                    <option>15</option>
                    <option>30</option>
                    <option selected="selected">45</option>
                </select>
            </div>    
        </div>
        <div class="areaIncrementos">
            <input type="button" value="+10" onclick="aumentaEXP(10)">
            <input type="button" value="+15" onclick="aumentaEXP(15)">
            <input type="button" value="+20" onclick="aumentaEXP(20)">
            <input type="button" value="+30" onclick="aumentaEXP(30)">
            <input type="button" value="+45" onclick="aumentaEXP(45)">
        </div>

        <div class="areaBotao">
            <input type="button" value="Calcular" onclick="calculaTempo()" style="width: 400px";>
        </div>
       
        <div class="areaResultado">
            <p>Tempo restantes: <span id="tempo"> </span></p>
        </div>
    </div>

    
</body>
</html>